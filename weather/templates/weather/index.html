{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Global Weather Network</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body style="background-image: url('{{ bg_image }}'); background-size: cover; background-position: center; background-repeat: no-repeat;">

<div class="overlay">
    <div class="container animated-fade">

        <h1 class="title">ğŸŒ¤ï¸ Global Weather Network</h1>

        <form method="get" class="search-form" onsubmit="localStorage.setItem('lastCity', document.querySelector('[name=city]').value)">
            <input type="text" name="city" placeholder="Search for a city..." 
                   value="{{ weather.city|default:'' }}">
            <button type="submit">Search</button>
        </form>

        {% if weather %}
        <div class="weather-card animated-slide">
            <h2 class="city">
                {{ weather.city }}
                {% if weather.country %}
                <img src="https://flagsapi.com/{{ weather.country }}/flat/32.png" 
                     style="vertical-align: middle; margin-left: 6px; border-radius: 4px;">
                {% endif %}
            </h2>

            <p class="local-time">ğŸ•’ {{ weather.local_time }}</p>
            <p class="temp" id="tempValue">{{ weather.temp }}Â°C</p>
            <button id="toggleTemp" class="toggle-btn">Switch to Â°F</button>
            <p class="description">{{ weather.description }}</p>

            <p>
                ğŸŒ¡ï¸ Feels Like: <strong>{{ weather.feels_like }}Â°C</strong> |
                ğŸŒ… Sunrise: <strong>{{ weather.sunrise }}</strong> |
                ğŸŒ‡ Sunset: <strong>{{ weather.sunset }}</strong>
            </p>
            <p class="details">
                ğŸ’§ Humidity: <strong>{{ weather.humidity }}</strong> |
                ğŸŒ¬ï¸ Wind: <strong>{{ weather.wind }} m/s</strong> |
                ğŸ“ Visibility: <strong>{{ weather.visibility }} km</strong> |
                ğŸ”½ Pressure: <strong>{{ weather.pressure }} hPa</strong>
            </p>

            <img class="weather-icon" 
                 src="https://openweathermap.org/img/wn/{{ weather.icon }}@2x.png" 
                 alt="icon" style="margin-top:12px;">
        </div>
        {% endif %}

        {% if hourly %}
        <h3 class="section-title">â±ï¸ Hourly Forecast</h3>
        <div class="forecast hourly-scroll">
            {% for h in hourly %}
            <div class="forecast-card animated-zoom">
                <p class="forecast-day">{{ h.time }}</p>
                <img src="https://openweathermap.org/img/wn/{{ h.icon }}@2x.png" alt="icon" style="margin-top:8px;">
                <p class="forecast-temp">{{ h.temp }}Â°C</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if forecast %}
        <h3 class="section-title">ğŸ“… 5-Day Forecast</h3>
        <div class="forecast">
            {% for f in forecast %}
            <div class="forecast-card animated-zoom">
                <p class="forecast-day">{{ f.day }}</p>
                <img src="https://openweathermap.org/img/wn/{{ f.icon }}@2x.png" alt="icon">
                <p class="forecast-temp">{{ f.temp }}Â°C</p>
                <p class="forecast-desc">{{ f.description }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if weather %}
        <h3 class="section-title">ğŸ—ºï¸ City Map</h3>
        <iframe
            class="map"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps?q={{ weather.lat }},{{ weather.lon }}&hl=en&z=12&output=embed">
        </iframe>
        {% endif %}

    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Temperature toggle
    const tempElement = document.getElementById("tempValue");
    const toggleButton = document.getElementById("toggleTemp");
    if (tempElement && toggleButton) {
        let celsius = parseFloat(tempElement.innerText);
        let isCelsius = true;
        toggleButton.addEventListener("click", function () {
            if (isCelsius) {
                let fahrenheit = (celsius * 9 / 5) + 32;
                tempElement.innerText = fahrenheit.toFixed(1) + "Â°F";
                toggleButton.innerText = "Switch to Â°C";
            } else {
                tempElement.innerText = celsius + "Â°C";
                toggleButton.innerText = "Switch to Â°F";
            }
            isCelsius = !isCelsius;
        });
    }

    // Auto-fill last searched city
    const lastCity = localStorage.getItem('lastCity');
    if (lastCity) {
        const input = document.querySelector('[name=city]');
        if (input) input.value = lastCity;
    }

    // Enter key triggers search
    const form = document.querySelector('.search-form');
    form.addEventListener("keypress", function(e){
        if(e.key === "Enter") form.submit();
    });
});
</script>
<!-- Footer -->
<footer style="text-align: center; padding: 20px 0; margin-top: 40px; 
               color: #f0f0f0; font-family: 'Inter', sans-serif; font-size: 14px; 
               background: rgba(0, 0, 0, 0.7); border-top: 1px solid rgba(255,255,255,0.3); 
               border-radius: 8px;">
    ğŸŒ Global Weather Network &mdash; thoughtfully designed and built by <strong>Yetbarek Temesgen</strong> Â© {{ now|date:"Y" }}.
</footer>

</body>
</html>
